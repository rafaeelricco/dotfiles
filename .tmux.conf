# Ensure a valid prefix table exists before unbinding
set -g prefix C-b
# Unbind all keys and reset configurations
unbind-key -T root -a
unbind-key -T copy-mode-vi -a
# Remove all default bindings
set -g status-keys emacs
set -g mode-keys emacs

# Reset escape time to a small nonzero value for reliable Meta detection
set -g escape-time 10

# Enable mouse support
set -g mouse on

# Start window numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Enable vi mode for copy-mode
set -g mode-keys vi

# Terminal features and colors
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"
# Enable extended keys (CSI u) where supported so Ctrl/Meta combos are distinct
set -as terminal-features 'xterm*:extkeys'

# Keybindings that mirror Ghostty terminal (conflict-safe)
# Window/Tab management
bind -n M-t new-window                           # alt+t (new window)
bind -n M-Q confirm-before -p "Kill tmux?" kill-server  # alt+shift+q (kill server)
bind -n M-n new-window                          # alt+n (new window)
# Use M-Enter for horizontal split to avoid conflict with Option+d (word delete)
bind -n M-Enter split-window -h                 # alt+enter (split pane horizontally)
bind -n M-D split-window -v                     # alt+shift+d (split pane vertically)
bind -n M-W kill-window                         # alt+shift+w (kill window)
# Free M-Left/M-Right for word navigation in shells (unbound here)
# bind -n M-Left previous-window                # removed to allow natural word-left
# bind -n M-Right next-window                   # removed to allow natural word-right
bind -n M-1 select-window -t 1                  # alt+1
bind -n M-2 select-window -t 2                  # alt+2
bind -n M-3 select-window -t 3                  # alt+3
bind -n M-4 select-window -t 4                  # alt+4
bind -n M-5 select-window -t 5                  # alt+5
bind -n M-6 select-window -t 6                  # alt+6
bind -n M-7 select-window -t 7                  # alt+7
bind -n M-8 select-window -t 8                  # alt+8
bind -n M-9 select-window -t 9                  # alt+9

# Pane management
bind -n M-h select-pane -L                      # alt+left (pane left)
bind -n M-j select-pane -D                      # alt+down (pane down)
bind -n M-k select-pane -U                      # alt+up (pane up)
bind -n M-l select-pane -R                      # alt+right (pane right)
bind -n M-z resize-pane -Z                      # alt+z (toggle fullscreen)
bind -n M-K clear-history                       # alt+shift+k (clear screen)
# Provide a non-conflicting kill-pane binding (free M-w for text editing)
bind -n M-x kill-pane                           # alt+x (kill pane)

# Pane resizing
bind -n M-C-h resize-pane -L 10                 # alt+ctrl+left
bind -n M-C-j resize-pane -D 10                 # alt+ctrl+down
bind -n M-C-k resize-pane -U 10                 # alt+ctrl+up
bind -n M-C-l resize-pane -R 10                 # alt+ctrl+right

# Copy mode and clipboard
bind -n M-c copy-mode -e                           # alt+c (enter copy-mode)
bind -n M-v paste-buffer                        # alt+v (paste)
bind -n M-= copy-mode \; send-keys -X search-backward   # alt+= (search backward)
bind -n M-- copy-mode \; send-keys -X search-forward    # alt+- (search forward)

# Text editing bindings (let shells handle natural Option-based editing)
# Keep only explicit helpers that do not conflict
bind -n M-BSpace send-keys M-BSpace             # option+backspace -> delete word backward
bind -n M-Delete send-keys M-d                  # option+delete   -> delete word forward

# Copy mode bindings (vi)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi Home send-keys -X start-of-line
bind -T copy-mode-vi End send-keys -X end-of-line
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Scroll bindings
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# Configuration reload
bind -n M-R source-file ~/.tmux.conf \; display "Config reloaded!"  # alt+shift+r

# Minimal status bar
set -g status-style bg=default
set -g status-left ""
set -g status-right ""
set -g status-justify left

# Clean window appearance
setw -g window-status-format "#I:#W"
setw -g window-status-current-format "#I:#W"
setw -g window-status-current-style fg=white
setw -g window-status-style fg=colour244

# Subtle pane borders
set -g pane-border-style fg=colour235
set -g pane-active-border-style fg=colour238

# Hide status bar by default
set -g status off